<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Scalachessjs test</title>
    <script>
      var worker = new Worker('target/scala-2.11/scalachessjs-fastopt.js');
      worker.addEventListener('message', function(e) {
        switch (e.data.topic) {
          case 'init':
            console.info('init', e.data.payload);
            break;
          case 'dests':
            console.timeEnd('dests');
            console.info('dest', e.data.payload);
            break;
          case 'fenMove':
            console.timeEnd('fenMove');
            console.info('fenMove', e.data.payload);
            break;
          case 'pgnMove':
            console.timeEnd('pgnMove');
            console.info('pgnMove', e.data.payload);
            break;
          case 'pgnRead':
            console.info('pgn', e.data.payload);
            break;
          case 'error':
            throw new Error(e.data.payload);
            break;
        }
      });
      worker.postMessage({
        topic: 'init',
        payload: {
          variant: 'chess960'
        }
      });
      function dests() {
        console.time('dests');
        worker.postMessage({
          topic: 'dests',
          payload: {
            fen: 'rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1',
            variant: 'kingOfTheHill'
          }
        });
      }
      function fenMove() {
        console.time('fenMove');
        worker.postMessage({
          topic: 'fenMove',
          payload: {
            fen: 'rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1',
            variant: 'threeCheck',
            orig: 'e2',
            dest: 'e4',
            path: '0'
          }
        });
      }
      function pgnMove() {
        console.time('pgnMove');
        worker.postMessage({
          topic: 'pgnMove',
          payload: {
            initialFen: 'rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1',
            variant: 'standard',
            pgnMoves: ['d4', 'Nf6', 'Nf3', 'Nc6', 'Nbd2', 'e6', 'e4', 'd6', 'c4', 'Qe7', 'Bd3', 'e5', 'd5', 'Nd4', 'Nxd4', 'exd4', 'O-O', 'Bg4', 'f3', 'Bd7', 'Nb3', 'Qe5', 'Be2', 'c5', 'dxc6', 'bxc6', 'Qxd4', 'Qxd4+','Nxd4', 'Rb8', 'b3', 'Be7', 'Be3', 'Bd8', 'Rfd1', 'Bb6', 'Kf2', 'Ke7', 'Rd2', 'Ba5', 'Rd3', 'Bb6', 'Rad1', 'Rhd8', 'g4', 'h6', 'Bf4', 'g5', 'Bg3', 'h5', 'h3', 'h4', 'Bh2', 'Rb7', 'e5', 'dxe5', 'Bxe5', 'Ne8', 'Kg2', 'Bc7', 'Bxc7', 'Rxc7', 'Nf5+','Kf8', 'f4', 'gxf4', 'Nxh4', 'Ng7', 'Bf3', 'Ne6', 'Nf5', 'Nc5', 'Rd4', 'Ne6', 'Rd6', 'c5', 'h4', 'Ng7', 'Nxg7', 'Kxg7', 'g5', 'a5', 'Kf2', 'Kf8', 'Bc6', 'Ke7', 'Ba4', 'Bxa4', 'Rxd8', 'Bc6', 'h5', 'Ke6', 'h6', 'Be4', 'Rh8', 'Re7', 'Re1', 'Kf5', 'h7', 'Kg6', 'Rc8', 'Kxh7', 'Rxc5', 'a4', 'b4', 'Kg6', 'b5', 'f6', 'gxf6', 'Kxf6', 'b6', 'a3', 'Rc7', 'Rxc7', 'bxc7', 'Bb7', 'Re8', 'Kf5', 'c5', 'Ba6', 'Ra8', 'Bb7', 'Rf8+', 'Ke5', 'c6', 'Ba6', 'Ra8', 'Kd6', 'Rxa6', 'Kxc7', 'Kf3', 'Kb8', 'Kxf4', 'Kc8', 'Ke5', 'Kc7', 'Ke6', 'Kd8', 'Kd6', 'Ke8', 'Ra7', 'Kf8', 'c7', 'Kf7', 'c8=Q+', 'Kg6', 'Qg4+','Kf6', 'Ra8', 'Kf7', 'Qf5+', 'Kg7', 'Ra7+', 'Kg8'],
            orig: 'f5',
            dest: 'c8'
          }
        });
      }
      function emptyPgnMove() {
        worker.postMessage({
          topic: 'pgnMove',
          payload: {
            initialFen: 'rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1',
            variant: 'standard',
            pgnMoves: [],
            orig: 'e2',
            dest: 'e4'
          }
        });
      }
      function pgnRead() {
        var drawPgn = '[Event "Fischer - Spassky World Championship Match"]\n' +
  '[Site "Reykjavik ISL"]\n' +
  '[Date "1972.08.22"]\n' +
  '[EventDate "?"]\n' +
  '[Round "17"]\n' +
  '[Result "1/2-1/2"]\n' +
  '[White "Boris Spassky"]\n' +
  '[Black "Robert James Fischer"]\n' +
  '[ECO "B09"]\n' +
  '[WhiteElo "?"]\n' +
  '[BlackElo "?"]\n' +
  '[PlyCount "89"]\n' +
  '\n' +
  '1. e4 d6 2. d4 g6 3. Nc3 Nf6 4. f4 Bg7 5. Nf3 c5 6. dxc5 Qa5\n' +
  '7. Bd3 Qxc5 8. Qe2 O-O 9. Be3 Qa5 10. O-O Bg4 11. Rad1 Nc6\n' +
  '12. Bc4 Nh5 13. Bb3 Bxc3 14. bxc3 Qxc3 15. f5 Nf6 16. h3 Bxf3\n' +
  '17. Qxf3 Na5 18. Rd3 Qc7 19. Bh6 Nxb3 20. cxb3 Qc5+ 21. Kh1\n' +
  'Qe5 22. Bxf8 Rxf8 23. Re3 Rc8 24. fxg6 hxg6 25. Qf4 Qxf4\n' +
  '26. Rxf4 Nd7 27. Rf2 Ne5 28. Kh2 Rc1 29. Ree2 Nc6 30. Rc2 Re1\n' +
  '31. Rfe2 Ra1 32. Kg3 Kg7 33. Rcd2 Rf1 34. Rf2 Re1 35. Rfe2 Rf1\n' +
  '36. Re3 a6 37. Rc3 Re1 38. Rc4 Rf1 39. Rdc2 Ra1 40. Rf2 Re1\n' +
  '41. Rfc2 g5 42. Rc1 Re2 43. R1c2 Re1 44. Rc1 Re2 45. R1c2\n' +
  '1/2-1/2';
        worker.postMessage({
          topic: 'pgnRead',
          payload: {
            pgn: drawPgn
          }
        });
      }
    </script>
  </head>
  <body>
    <h1>Scalachessjs test page</h1>
  </body>
</html>
